function changeLang(e){i18n.init({lng:e,resGetPath:"../../locales/__lng__/__ns__.json"},function(){$("body").i18n()})}function getUser(){return null==sessionStorage.getItem("user")?{id:17,loginname:"anonymous",display:"Anonymous"}:JSON.parse(sessionStorage.user)}function compare(e,t){return e.trim().replace(/ /g,"")===t.trim().replace(/ /g,"")}function filter(e,t,n){var a=[];return $.each(e,function(r){e[r][t]==n&&a.push(e[r])}),a}function gameOver(e,t,n,a,r,o){var i=0;i=r/o>=.8?3:r/o>=.5?2:r/o>=.3?1:0;var s=r;saveScore(e,t,n,a,i,s),$(".game-over-modal-sm .game-star").html(i),$(".game-over-modal-sm .game-score").html(s),$(".game-over-modal-sm").modal({keyboard:!1}),$(".game-over-modal-sm").on("hide.bs.modal",function(){window.history.back()})}function akiraShuffle(e){for(var t,n,a=e.length;0!==a;)n=Math.floor(Math.random()*a),a-=1,t=e[a],e[a]=e[n],e[n]=t;return e.splice(0,9)}function genAnswers(e,t,n){var a=[];return $.each(e,function(r){var o,i=[];i.push(e[r][t]);do o=Math.floor(Math.random()*e.length);while(o==r);if(i.push(e[o][t]),3==n){var s;do s=Math.floor(Math.random()*e.length);while(s==r||s==o);i.push(e[s][t])}a[r]=akiraShuffle(i)}),a}function genAnswers3(e,t){var n=[];return $.each(e,function(a){var r,o=[];o.push(e[a]);do r=Math.floor(Math.random()*e.length);while(r==a);if(o.push(e[r]),3==t){var i;do i=Math.floor(Math.random()*e.length);while(i==a||i==r);o.push(e[i])}n[a]=akiraShuffle(o)}),n}function genAnswers2(e){var t=[];return $.each(e,function(n){var a=e[n].hiragana.trim().replace(/ /g,String.fromCharCode(12288)).replace(new RegExp(String.fromCharCode(12288)+"{1,}","g"),"|").split("|");t[n]=akiraShuffle(a)}),t}function saveScore(e,t,n,a,r,o){$.ajax({type:"POST",url:"http://akira.edu.vn/wp-content/plugins/akira-api/save_score.php",crossDomain:!0,data:{userId:getUser().id,course:e,lesson:t,subtopic:n,game:a,star:r,exp:o}}).done(function(){console.info("Score saved")})}function akiraStepValidation(e){var t=$("#input-"+e).val(),n=$("#ans-"+e).val(),a=$("#mess-"+e).html();return $(".mess-holder-"+e+" >div").first().html(a),$(".failed").removeClass("failed"),$(".success").removeClass("success"),compare(t,n)?($(".mess-holder-"+e).addClass("success"),$(".mess-holder-"+e+" >div").first().find(".fa").css("color","green"),!0):($(".mess-holder-"+e).addClass("failed"),$(".mess-holder-"+e+" >div").first().find(".fa").css("color","red"),!1)}function leaveAStepCallback(e,t){var n="success",a=compare($("#ans-"+(t.fromStep-1)).val(),$("#input-"+(t.fromStep-1)).val());return a||($("#sublife").trigger("click"),n="failed"),$(".swMain .actionBar .msgBox").removeClass("failed"),$(".swMain .actionBar .msgBox").removeClass("success"),$(".swMain .actionBar .msgBox").addClass(n),$(".swMain").smartWizard("showMessage",$("#mess-"+(t.fromStep-1)).html()),a}function grammarChoiceLeaveStep(e,t){var n=compare($("#ans-"+(t.fromStep-1)).val(),$("#input-"+(t.fromStep-1)).val());return n||($("#sublife").trigger("click"),$(".swMain").smartWizard("showMessage",$("#mess-"+(t.fromStep-1)).html())),n}function akrLeaveStep(e,t){if(14===getUser.id&&17===getUser.id)return!0;var n=angular.element("#"+e.context.id).scope();if(void 0===n.lessonId);else if(void 0!==n.lessonId&&void 0!==n.partId&&"subtopicWizard"===e.context.id){var a=getCurrentStar(n.starData,n.course,n.lessonId,t.toStep);if(4===t.toStep&&("totaln5"==n.course||"totaln4"==n.course))return!1;if(a<10*(t.toStep-1))return!1}return!0}function akrShowStep(e,t){var n=angular.element("#"+e.context.id).scope();"true"==$("#"+e.context.id).attr("akrautoplayaudio")&&n.playSound(t.toStep-1,!0),"true"==$("#"+e.context.id).attr("akrfocus")&&setTimeout(function(){$("#input-"+(t.toStep-1)).focus()},1)}function getCurrentStar(e,t,n,a){var r=0;return $.each(e[t][n],function(o){return o>a?!1:void $.each(e[t][n][o],function(a){r+=parseInt(e[t][n][o][a])})}),r}function getCourseStar(e,t){var n=0;return $.each(e[t],function(a){$.each(e[t][a],function(r){$.each(e[t][a][r],function(o){n+=parseInt(e[t][a][r][o])})})}),n}function getCourseProgress(e,t,n,a){var r=[],o=n*a*3;return $.each(e[t],function(n){var a=0;$.each(e[t][n],function(r){$.each(e[t][n][r],function(o){a+=parseInt(e[t][n][r][o])})}),r[n]=a/o*100}),r}function getTotalStar(e,t){var n=0,a=0;return $.each(e[t],function(r){$.each(e[t][r],function(o){$.each(e[t][r][o],function(i){4==o?a+=parseInt(e[t][r][o][i]):n+=parseInt(e[t][r][o][i])})})}),{vocab:n,grammar:a}}function getTotalProgress(e,t,n,a){var r=[],o=[],i=(n-1)*a*3,s=3*a;return $.each(e[t],function(a){var c=0,u=0;$.each(e[t][a],function(r){$.each(e[t][a][r],function(o){r==n?u+=parseInt(e[t][a][r][o]):c+=parseInt(e[t][a][r][o])})}),r[a]=c/i*100,o[a]=u/s*100}),{vocab:r,grammar:o}}function getTotalLessonStar(e,t,n){var a=0,r=0;return $.each(e[t][n],function(o){$.each(e[t][n][o],function(i){4==o?r+=parseInt(e[t][n][o][i]):a+=parseInt(e[t][n][o][i])})}),{vocab:a,grammar:r}}function getLessonStar(e,t,n){var a=0;return $.each(e[t][n],function(r){$.each(e[t][n][r],function(o){a+=parseInt(e[t][n][r][o])})}),a}function kanjiDict(){$(".kanji-dict").hover(function(e){$(e.target).popover({content:translate($(e.target).text()),placement:"bottom",trigger:"hover"}),$(e.target).popover("show")})}function translate(e){return e}function getUnlockedSub(e,t,n){var a=[],r=0;return $.each(e[t][n],function(o){var i=10*(o-1);return $.each(e[t][n][o],function(a){r+=parseInt(e[t][n][o][a])}),r>=i?void a.push(parseInt(o)):!1}),a}function playCorrect(){document.getElementById("sound-true").play()}function playFail(){document.getElementById("sound-fail").play()}var app={initialize:function(){this.bindEvents(),changeLang(i18n.lng())},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){app.receivedEvent("deviceready")},receivedEvent:function(e){var t=document.getElementById(e),n=t.querySelector(".listening"),a=t.querySelector(".received");n.setAttribute("style","display:none;"),a.setAttribute("style","display:block;"),console.log("Received Event: "+e)}};!function(e){e.fn.shuffle=function(){var t=this.get(),n=function(e){return Math.floor(Math.random()*e)},a=e.map(t,function(){var a=n(t.length),r=e(t[a]).clone(!0)[0];return t.splice(a,1),r});return this.each(function(t){e(this).replaceWith(e(a[t]))}),e(a)}}(jQuery);